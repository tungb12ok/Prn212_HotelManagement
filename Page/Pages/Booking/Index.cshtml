@page
@model Page.Pages.Booking.BookingModel
@{
    ViewData["Title"] = "Booking";
}
<h1>Booking</h1>
<form method="post" asp-page="Index">
    <div class="form-group">
        <label>CustomerId:</label>
        <input asp-for="CustomerId" name="customerId" class="form-control"/>
    </div>
    <div class="form-group">
        <label>Ngày bắt đầu:</label>
        <input type="date" asp-for="StartDate" class="form-control"/>
    </div>
    <div class="form-group">
        <label>Ngày kết thúc:</label>
        <input type="date" asp-for="EndDate" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Search Room:</label>
        <input type="text" id="roomSearch" class="form-control" placeholder="Type to search rooms...">
    </div>

    <div id="room-list">
        @foreach (var room in Model.Rooms)
        {
        <div class="checkbox" style="display:block;">
            <label>
                <input type="checkbox" name="RoomIds" value="@room.Value" class="room-option"/>
                @room.Text
            </label>
        </div>
        }
    </div>

    <button type="submit" class="btn btn-primary">Đặt phòng</button>
</form>
@section Scripts {
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder().withUrl("/bookingHub").build();

        connection.on("ReceiveRoomUpdate", function (roomIds) {
            const roomOptions = document.querySelectorAll('.room-option');
            roomOptions.forEach(option => {
                if (roomIds.includes(parseInt(option.value))) {
                    option.parentElement.parentElement.style.display = 'none';
                }
            });
        });

        connection.start().catch(function (err) {
            return console.error(err.toString());
        });

        // Kết nối với các đoạn mã đã có
        document.addEventListener('DOMContentLoaded', function() {
            const searchBox = document.getElementById('roomSearch');
            const roomOptions = document.querySelectorAll('.room-option');

            searchBox.addEventListener('input', function() {
                const searchText = searchBox.value.toLowerCase();
                roomOptions.forEach(option => {
                    const label = option.parentElement.textContent.toLowerCase();
                    if (label.includes(searchText)) {
                        option.parentElement.parentElement.style.display = 'block';
                    } else {
                        option.parentElement.parentElement.style.display = 'none';
                    }
                });
            });
        });
    </script>
}


